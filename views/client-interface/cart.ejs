<!DOCTYPE html>
<html lang="en">
  <head>
    <title>BookVerse – Cart</title>

    <link rel="icon" type="image/x-icon" href="/assets/logo/logo_favicon.png" />

    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <meta
      name="description"
      content="Your BookVerse shopping cart – review your books and checkout securely."
    />

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <link rel="stylesheet" href="/styles/client-styles.css" />
  </head>

  <body>
    <%- include('includes/header') %>

    <main>
      <section class="cart-container container flex-c gap-5">
        <section class="cart-main-section">
          <div class="cart-main-section1">
            <h1 class="pb-5">Your Cart</h1>

            <% cartItems.forEach((item, index) => { %>
            <div class="item pb-5 flex">
              <div class="flex-row gap-4">
                <a href="/<%= item.href %>">
                  <img
                    src="/assets/images/books/<%= item.img %>"
                    alt="<%= item.title %>"
                  />
                </a>

                <div>
                  <h6><%= item.title %></h6>

                  <div class="quantity-selector">
                    <div class="circle decrease" data-index="<%= index %>">
                      -
                    </div>
                    <div class="number" id="qty-<%= index %>">
                      <%= item.quantity %>
                    </div>
                    <div class="circle increase" data-index="<%= index %>">
                      +
                    </div>
                  </div>
                </div>
              </div>

              <div class="price-item">
                <h6><%= item.price.toFixed(2) %>$</h6>
              </div>
            </div>
            <% }) %>
          </div>

          <hr />
          <div class="cart-main-section2">
            <div class="flex-row mt-5 mb-5">
              <h6 style="font-size: larger">
                Your Total Including Shipping is
              </h6>
              <h6 style="font-size: larger">
                <u>
                  <%= cartItems.reduce((sum, item) => sum + item.price,
                  0).toFixed(2) %>$
                </u>
              </h6>
            </div>

            <h2 class="mb-3">Checkout</h2>

            <div class="checkout-form form pb-5">
              <form class="row g-3" id="cart-form">
                <div class="col-md-6">
                  <label for="phone">Phone number</label>
                  <div class="input-group">
                    <span class="input-group-text">+961</span>
                    <input type="text" id="phone" required />
                  </div>
                </div>

                <div class="col-md-6">
                  <label for="governorate">Governorate</label><br />
                  <select id="governorate" style="padding: 8px 9px" required>
                    <option value="BA">Beirut</option>
                    <option value="JL">Mount Lebanon</option>
                    <option value="AS">North Governorate</option>
                    <option value="JA">South Governorate</option>
                    <option value="NA">Nabatieh</option>
                    <option value="BI">Beqaa</option>
                    <option value="BH">Baalbek-Hermel</option>
                    <option value="AK">Akkar</option>
                  </select>
                </div>

                <div class="col-md-12 pt-4">
                  <label>Precise Location</label>
                  <textarea class="w-100" required></textarea>
                </div>

                <div class="col-12 pt-3">
                  <div class="form-check">
                    <input
                      class="form-check-input"
                      type="checkbox"
                      id="terms"
                      required
                    />
                    <label class="form-check-label" for="terms">
                      Agree to terms and conditions
                    </label>
                  </div>
                </div>

                <div class="col-12">
                  <button class="button-1 w-100" type="submit">Checkout</button>
                </div>
              </form>
              <div
                class="modal fade"
                id="checkoutDone"
                tabindex="-1"
                aria-hidden="true"
              >
                <div class="modal-dialog modal-dialog-centered">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h5 class="modal-title">Thank you!</h5>
                      <button
                        type="button"
                        class="btn-close"
                        data-bs-dismiss="modal"
                      ></button>
                    </div>
                    <div class="modal-body">
                      Your order is confirmed. We will process it shortly.
                    </div>

                    <div class="modal-footer">
                      <button
                        type="button"
                        class="button-1"
                        data-bs-dismiss="modal"
                      >
                        Close
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>

        <section class="cart-secondary">
          <div class="favorites">
            <h2 class="pt-3 pr-4 pb-2">Your Favorites</h2>

            <% favorites.forEach(fav => { %>
            <div class="item2 pb-4">
              <div class="flex-row gap-4">
                <a href="/<%= fav.href %>">
                  <img
                    src="/assets/images/books/<%= fav.img %>"
                    alt="<%= fav.title %>"
                  />
                </a>

                <div>
                  <h6><%= fav.title %></h6>
                  <h6 style="font-weight: bolder">
                    <%= fav.price.toFixed(2) %>$
                  </h6>
                  <button class="button-2">Add to Cart</button>
                </div>
              </div>
            </div>
            <% }) %>
          </div>
        </section>
      </section>
    </main>

    <%- include('includes/footer') %>

    <!-- QUANTITY SCRIPT -->
    <script>
      document.querySelectorAll(".increase").forEach((btn) => {
        btn.addEventListener("click", () => {
          const index = btn.dataset.index;
          const qtyEl = document.getElementById(`qty-${index}`);
          qtyEl.textContent = Number(qtyEl.textContent) + 1;
        });
      });

      document.querySelectorAll(".decrease").forEach((btn) => {
        btn.addEventListener("click", () => {
          const index = btn.dataset.index;
          const qtyEl = document.getElementById(`qty-${index}`);
          const current = Number(qtyEl.textContent);
          if (current > 1) qtyEl.textContent = current - 1;
        });
      });

      // Checkout modal trigger
      document.getElementById("cart-form").addEventListener("submit", (e) => {
        e.preventDefault();
        const modal = new bootstrap.Modal(
          document.getElementById("checkoutDone")
        );
        modal.show();
      });
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
